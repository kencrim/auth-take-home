<!DOCTYPE html>
<html lang="eng">
<head>
	<meta charset="utf-8" />
	<meta name="google-signin-client_id" content="537521020853-sr6vfmg034hi3cf10sj17q8qu9plbdf2.apps.googleusercontent.com">
	<title>Add Title</title>
	<script src="https://apis.google.com/js/platform.js" async defer></script>
</head>
<body>
	<div class="g-signin2" data-onsuccess="onSignIn"></div>
	<a href="#" onclick="signOut();">Sign out</a>
	<script>
		function onSignIn(googleUser) {
			
			// Gets auth token from Google User auth object
  			var id_token = googleUser.getAuthResponse().id_token;

  			// Sends token to server where it can be verified
  			fetch('http://lvh.me:3000/api/login', {
		        method: "POST", 
		        mode: "cors",
		        cache: "no-cache", 
		        credentials: "same-origin",
				headers: {
			    	'Content-Type': 'application/json',
				},
		        body: JSON.stringify({id_token}),
		    })
		    // Parse the response to json
		    .then(response => response.json())
		    .then((data) => {
		    	console.log(data)
		    	return fetch('http://lvh.me:3000/api/users', {
		    		method: "POST",
		    		mode: "cors",
			        cache: "no-cache", 
			        credentials: "same-origin",
					headers: {
				    	'Content-Type': 'application/json',
				    	'authorization': 'Bearer ' + data.token
					},
		    	})
		    	.then(response => response.json())
		    	.then(json => console.log(json));
		    });
		}
		function signOut() {
		    var auth2 = gapi.auth2.getAuthInstance();
			auth2.signOut().then(function () {
		    	console.log('User signed out.');
			});
		}
	</script>
</body>
</html>